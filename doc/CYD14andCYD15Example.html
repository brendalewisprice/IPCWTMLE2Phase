<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Brenda Price" />


<title>IPCWTMLE Example Using Simulated CYD14 and CYD15 Two-Phase Data</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">IPCWTMLE Example Using Simulated CYD14 and CYD15 Two-Phase Data</h1>
<h4 class="author"><em>Brenda Price</em></h4>
<h4 class="date"><em>27 September, 2019</em></h4>



<div id="summary" class="section level2">
<h2>Summary</h2>
<p>This vignette demonstrates the application of IPCW-TMLE to data sets simulated to mimic two phase 3 clinical trials investigating the vaccine efficacy of a dengue vaccine using the approach presented in <span class="citation">Rose and Laan (2011)</span> and demonstrated in <span class="citation">Price and Gilbert (2020)</span>. For comparison, the Breslow-Holubkov approach for two-phase sampling estimation is also demonstrated (<span class="citation">Breslow and Holubkov (1997)</span>).</p>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
</div>
<div id="data-set" class="section level2">
<h2>Data set</h2>
<p>Two randomized, double-blinded, placebo-controlled, multicenter, Phase 3 trials of the identical recombinant, live, attenuated, tetravalent dengue vaccine (CYD-TDV) versus placebo were conducted in Asia (<span class="citation">Capeding et al. (2014)</span>) and Latin America (<span class="citation">Villar et al. (2015)</span>). These trials–labeled CYD14 and CYD15–randomized 10,275 and 20,869 children, respectively, in 2:1 allocation to vaccine:placebo, with immunizations administered at months 0, 6, and 12. The primary analyses assessed vaccine efficacy (<span class="math inline">\(VE\)</span>) against symptomatic, virologically confirmed dengue (VCD) occurring at least 28 days after the third immunization through to the Month 25 visit. Based on a proportional hazards model, estimated <span class="math inline">\(VE\)</span> was 56.5% (95% CI 43.8–66.4) for CYD14 and 64.7% (95% CI 58.7–69.8) for CYD15.</p>
<p>The trials measured neutralizing antibody titers to each of the four dengue serotypes contained in the CYD-TDV vaccine at baseline and at Month 13. These titers were measured via case-cohort sampling performed as Bernoulli random samples of all randomized participants at enrollment and additionally from all participants who experienced the VCD endpoint after Month 13 and by Month 25 (cases). An individual’s Month 13 log10-transformed geometric mean titer to the four vaccine-strain serotypes (``M13 average titer“) has been studied as a biomarker of dengue risk and vaccine efficacy in secondary analyses (<span class="citation">Vigne et al. (2017)</span>, <span class="citation">Z. Moodie et al. (2018)</span>, <span class="citation">Sridhar et al. (2018)</span>), and for this example we study this marker as our phase 2 variable of interest.</p>
</div>
<div id="simulated-data-sets" class="section level2">
<h2>Simulated Data Sets</h2>
<p>For this Vignette, we will not use the actual data from these vaccine trials, but data that has been simulated to be similar in distribution to the actual vaccine trial data. These simulated data sets are included in this package under the names “simCYD14_twostage.RData” and “simCYD15_twostage.RData”. The outcome for the clinical trials is virally confirmed dengue (VCD), coded in the data sets as 1 for VCD and 0 otherwise. Covariates adjusted for in the models include age, gender, and country. The phase two sample is taken as a stratified sample based on outcome (VCD or no-VCD) and vaccination status (vaccine or placebo), and is coded for in the data set as delta=1 for phase 2 selection (0 otherwise). Individual observation level weights reflect the probability of sampling to phase two. For this analysis, the data sets are combined. Further details on the data sets can be found in the package documentation under “simCYD14_twostage” and “simCYD15_twostage”.</p>
<div id="analysis-approach" class="section level3">
<h3>Analysis Approach</h3>
<p>IPCW-TMLE methodology is applied to assess the association of M13 average titer with the subsequent risk of VCD through Month 25 (variable “VCD”). We investigate how the risk of VCD compares between vaccine recipients with above median versus below median values of M13 average titer (“M13_PRNT_SeroAverage”), coded below as <span class="math inline">\(A=1\)</span> and <span class="math inline">\(A=0\)</span> respectively. Our parameters of interest are the two marginalized risks <span class="math inline">\(\Psi_1 = E[E(Y=1|A=1,X)]\)</span> and <span class="math inline">\(\Psi_0 = E[E(Y=1|A=0,X)]\)</span>, where <span class="math inline">\(X\)</span> represents the phase 1 baseline covariates age, gender, and country of origin. We also are interested in specified contrasts <span class="math inline">\(\theta = h(\Psi_1,\Psi_0)\)</span> such as the marginalized risk difference (<span class="math inline">\(\theta =\Psi_1-\Psi_0\)</span>), the relative marginalized risk <span class="math inline">\(\theta = \Psi_1 / \Psi_0\)</span>, the relative marginalized odds ratio <span class="math inline">\(\theta = \Psi_1/(1-\Psi_1) / \Psi_0/(1-\Psi_0)\)</span>,</p>
<p>IPCW-TMLE estimates of <span class="math inline">\(\Psi_1\)</span>, <span class="math inline">\(\Psi_0\)</span>, and <span class="math inline">\(\theta\)</span> are obtained using the methods described in Price and Gilbert (2020), and Breslow-Holubkov estimates are obtained using the “tps” function from the package .</p>
</div>
</div>
<div id="first-load-and-prepare-the-data" class="section level2">
<h2>First, load and prepare the data</h2>
<p>The two simulated data sets are included in the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the data sets and needed packages</span>
<span class="co"># call libraries</span>
<span class="kw">library</span>(SuperLearner)
<span class="kw">library</span>(IPCWTMLE)
<span class="kw">data</span>(simCYD14_twostage)
<span class="kw">data</span>(simCYD15_twostage)</code></pre></div>
<p>The data sets consist of 40 variables with 10,250 and 20,500 subjects, respectively. For more details on the data sets, please see the documentation included in this package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(simCYD14_twostage)</code></pre></div>
<pre><code>## [1] 10250    40</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(simCYD15_twostage)</code></pre></div>
<pre><code>## [1] 20500    40</code></pre>
<p>For this analysis, combine data sets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">rbind</span>(simCYD14_twostage,simCYD15_twostage)
<span class="kw">dim</span>(dat)</code></pre></div>
<pre><code>## [1] 30750    40</code></pre>
<p>To address the qustion of interest, code the geometric mean titer to above and below median value for each data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat$A &lt;-<span class="st"> </span><span class="kw">ifelse</span>(dat$M13_PRNT_SeroAverage &gt;=<span class="st"> </span><span class="kw">median</span>(dat$M13_PRNT_SeroAverage),<span class="dv">1</span>,<span class="dv">0</span>)</code></pre></div>
<p>Then select the input variables for the IPCW-TMLE approach and define a formula for the BH approach:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SL.W &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;VACC&quot;</span>,<span class="st">&quot;AGEYRS&quot;</span>,<span class="st">&quot;MALE&quot;</span>,<span class="st">&quot;MYS&quot;</span>,<span class="st">&quot;IDN&quot;</span>,<span class="st">&quot;THA&quot;</span>,<span class="st">&quot;VNM&quot;</span>,<span class="st">&quot;COL&quot;</span>,<span class="st">&quot;HND&quot;</span>,<span class="st">&quot;PRI&quot;</span>, <span class="st">&quot;MEX&quot;</span>,<span class="st">&quot;M13_MNv2_SeroAverage&quot;</span> )
fmla =<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste</span>(<span class="st">&quot;VCD ~ A + factor(VACC) + AGEYRS + MALE + MYS + IDN + THA + VNM + COL + HND + PRI + MEX&quot;</span>))</code></pre></div>
</div>
<div id="ipcw-tmle-estimation" class="section level2">
<h2>IPCW-TMLE Estimation</h2>
<p>Run the main IPCW-TMLE function to estimate the marginal additive difference, marginal relative risk, and marginal log odds ratio. See package documentation for further details on the inputs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out &lt;-<span class="st"> </span><span class="kw">weighted.tmle.separate</span>(<span class="dt">w=</span>dat[,SL.W], 
                       <span class="dt">a=</span>dat$A, 
                       <span class="dt">y=</span>dat$VCD, 
                       <span class="dt">delta=</span>dat$delta, 
                       <span class="dt">Q.SL.library=</span><span class="kw">c</span>(<span class="st">&quot;SL.mean&quot;</span>,<span class="st">&quot;SL.glm&quot;</span> ), <span class="co">#,&quot;SL.step&quot;,&quot;SL.glmnet&quot;), </span>
                       <span class="dt">g.SL.library=</span><span class="kw">c</span>(<span class="st">&quot;SL.mean&quot;</span>,<span class="st">&quot;SL.glm&quot;</span>), 
                       <span class="dt">wgts=</span>dat$weight,
                       <span class="dt">max.wgt =</span> <span class="ot">Inf</span>)</code></pre></div>
<div id="output-the-desired-estimates" class="section level3">
<h3>Output the desired estimates</h3>
<p>Estimated means and confidence intervals for <span class="math inline">\(E[E[Y|A=1,W]]\)</span> and <span class="math inline">\(E[E[Y|A=0,W]]\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste0</span>(<span class="st">&quot;EY1: &quot;</span>,<span class="kw">round</span>(out$EY1,<span class="dv">3</span>),<span class="st">&quot;; 95% CI: (&quot;</span>,<span class="kw">round</span>(out$ci1[<span class="dv">1</span>],<span class="dv">3</span>),<span class="st">&quot;,&quot;</span>,<span class="kw">round</span>(out$ci1[<span class="dv">2</span>],<span class="dv">3</span>) ,<span class="st">&quot;)&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;EY1: 0.011; 95% CI: (0.002,0.019)&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste0</span>(<span class="st">&quot;EY0: &quot;</span>,<span class="kw">round</span>(out$EY0,<span class="dv">3</span>),<span class="st">&quot;; 95% CI: (&quot;</span>,<span class="kw">round</span>(out$ci0[<span class="dv">1</span>],<span class="dv">3</span>),<span class="st">&quot;,&quot;</span>,<span class="kw">round</span>(out$ci0[<span class="dv">2</span>],<span class="dv">3</span>) ,<span class="st">&quot;)&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;EY0: 0.038; 95% CI: (0.032,0.044)&quot;</code></pre>
<p>Estimates and confidence intervals for the marginalized risk difference, marginalized risk ratio, and marginalized odds ratio:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste0</span>(<span class="st">&quot;Risk Difference: &quot;</span>,<span class="kw">round</span>(out$est.RiskDiff,<span class="dv">3</span>),<span class="st">&quot;; 95% CI: (&quot;</span>,<span class="kw">round</span>(out$ci.RiskDiff[<span class="dv">1</span>],<span class="dv">3</span>),<span class="st">&quot;,&quot;</span>,<span class="kw">round</span>(out$ci.RiskDiff[<span class="dv">2</span>],<span class="dv">3</span>) ,<span class="st">&quot;)&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Risk Difference: -0.027; 95% CI: (-0.033,-0.022)&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste0</span>(<span class="st">&quot;RR: &quot;</span>,<span class="kw">round</span>(out$est.RR,<span class="dv">3</span>),<span class="st">&quot;; 95% CI: (&quot;</span>,<span class="kw">round</span>(out$ci.rr[<span class="dv">1</span>],<span class="dv">3</span>),<span class="st">&quot;,&quot;</span>,<span class="kw">round</span>(out$ci.rr[<span class="dv">2</span>],<span class="dv">3</span>) ,<span class="st">&quot;)&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;RR: 0.279; 95% CI: (0.186,0.418)&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste0</span>(<span class="st">&quot;OR: &quot;</span>,<span class="kw">round</span>(out$est.OR,<span class="dv">3</span>),<span class="st">&quot;; 95% CI: (&quot;</span>,<span class="kw">round</span>(out$ci.OR[<span class="dv">1</span>],<span class="dv">3</span>),<span class="st">&quot;,&quot;</span>,<span class="kw">round</span>(out$ci.OR[<span class="dv">2</span>],<span class="dv">3</span>) ,<span class="st">&quot;)&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;OR: 0.382; 95% CI: (0.254,0.575)&quot;</code></pre>
<p>If only the IPCW-TMLE of the predicted values are desired, the <em>weighted.tmle.predicted.values</em> function can be used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out.fitted &lt;-<span class="st"> </span><span class="kw">weighted.tmle.predicted.values</span>(<span class="dt">w=</span>dat[,SL.W], 
                       <span class="dt">a=</span>dat$A, 
                       <span class="dt">y=</span>dat$VCD, 
                       <span class="dt">delta=</span>dat$delta, 
                       <span class="dt">Q.SL.library=</span><span class="kw">c</span>(<span class="st">&quot;SL.mean&quot;</span>,<span class="st">&quot;SL.glm&quot;</span>), 
                       <span class="dt">g.SL.library=</span><span class="kw">c</span>(<span class="st">&quot;SL.mean&quot;</span>), 
                       <span class="dt">wgts=</span>dat$weight,
                       <span class="dt">max.wgt =</span> <span class="ot">Inf</span>)</code></pre></div>
<p>The resulting “fitted.values” are the IPCW-TMLE fitted values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(out.fitted$fitted.values)</code></pre></div>
<pre><code>[1] 0.05155352 0.01887388 0.04219149 0.06344108 0.06620216 0.04299685</code></pre>
</div>
</div>
<div id="breslow-holubkov-estimation-for-comparison" class="section level2">
<h2>Breslow-Holubkov Estimation for Comparison</h2>
<p>For application of the Breslow-Holubkov approach for estimation in two-phase studies, the “tps” function from the  package can be used along with some additional steps utilizing the delta method to obtain the same estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make sure osDesign is loaded</span>
  if (!<span class="kw">require</span>(osDesign)) <span class="kw">install.packages</span>(<span class="st">'osDesign'</span>)
  <span class="kw">library</span>(osDesign)
<span class="co"># Phase I counts for use in the tps function</span>
nn0&lt;-<span class="kw">c</span>(<span class="kw">sum</span>(dat$weight[dat$VCD==<span class="dv">0</span> &amp;dat$VACC==<span class="dv">0</span>]),<span class="kw">sum</span>(dat$weight[dat$VCD==<span class="dv">0</span> &amp;dat$VACC==<span class="dv">1</span>]))
nn1&lt;-<span class="kw">c</span>(<span class="kw">sum</span>(dat$weight[dat$VCD==<span class="dv">1</span> &amp;dat$VACC==<span class="dv">0</span>]),<span class="kw">sum</span>(dat$weight[dat$VCD==<span class="dv">1</span> &amp;dat$VACC==<span class="dv">1</span>]))

<span class="co"># osDesign requires the stratification variable to be coded 1,2,..K for K strata</span>
dat$S &lt;-<span class="st"> </span>dat$VACC +<span class="st"> </span><span class="dv">1</span>
    
<span class="co"># using osDesign package, calculate the BH estimator (&quot;method='ML'&quot;)</span>
<span class="co"># using only the phase 2 sample of data, but includeing the phase 1 counts as nn0 and nn1</span>
dat<span class="fl">.2</span> &lt;-<span class="st"> </span>dat[dat$delta==<span class="dv">1</span>,]
tps.fit &lt;-<span class="st"> </span><span class="kw">tps</span>(fmla, <span class="dt">data=</span>dat<span class="fl">.2</span>, <span class="dt">nn0=</span>nn0, <span class="dt">nn1=</span>nn1, <span class="dt">group=</span>dat<span class="fl">.2</span>$VACC, <span class="dt">method=</span><span class="st">&quot;ML&quot;</span>)</code></pre></div>
<pre><code>
 WARNING: ML estimates don't satisfy appropriate constraints</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Run the package function to output the corresponding estimates for the BH approach
out.BH &lt;-<span class="st"> </span><span class="kw">BH.Estimates</span>(<span class="dt">fmla=</span>fmla,<span class="dt">dat=</span>dat,<span class="dt">tps.fit=</span>tps.fit)
## Print the corresponding estimates for the BH approach
out.BH</code></pre></div>
<pre><code>$EY1
[1] 0.005180449

$EY0
[1] 0.02242305

$ci1
[1] 0.004118421 0.006242477

$ci0
[1] 0.02011325 0.02473285

$RiskDiff
[1] -0.0172426

$ci.RiskDiff
[1] -0.01978486 -0.01470034

$RR
[1] 0.2310323

$ci.RR
[1] 0.1836672 0.2906121

$OR
[1] 0.2270279

$ci.OR
[1] 0.1806040 0.2955412</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-BreslowHul1997">
<p>Breslow, N.E., and R. Holubkov. 1997. “Maximum Likelihood Estimation of Logistic Regres- Sion Parameters for Two-Phase Outcome-Dependent Sampling.” <em>Journal of the Royal Statistical Society</em> 59: 447–61.</p>
</div>
<div id="ref-Capedingetal2014">
<p>Capeding, Maria Rosario, Ngoc Huu Tran, Sri Rezeki S Hadinegoro, Hussain Imam HJ Muhammad Ismail, Tawee Chotpitayasunondh, Mary Noreen Chua, Chan Quang Luong, et al. 2014. “Clinical Efficacy and Safety of a Novel Tetravalent Dengue Vaccine in Healthy Children in Asia: A Phase 3, Randomised, Observer-Masked, Placebo-Controlled Trial.” <em>The Lancet</em> 384 (9951). Elsevier: 1358–65.</p>
</div>
<div id="ref-Moodieetal2018">
<p>Moodie, Z, M Juraska, Y Huang, Y Zhuang, Y Fong, LN Carpp, SG Self, et al. 2018. “Neutralizing Antibody Correlates Analysis of Tetravalent Dengue Vaccine Efficacy Trials in Asia and Latin America.” <em>Journal of Infectious Diseases</em> 217(5): 742–53.</p>
</div>
<div id="ref-Price2020">
<p>Price, Brenda L, and Peter H Gilbert. 2020. “Comparing targeted minimum loss-based and Breslow-Holubkov methodology for two-phase sampling data designs.” <em>Statistical Communications in Infectious Diseases</em> x (X): x–x.</p>
</div>
<div id="ref-RosevanderLaan2011">
<p>Rose, Sherri, and Mark J van der Laan. 2011. “A Targeted Maximum Likelihood Estimator for Two-Stage Designs.” <em>The International Journal of Biostatistics</em> 7 (1): 1–21.</p>
</div>
<div id="ref-Sridhar2018">
<p>Sridhar, Saranya, Alexander Luedtke, Edith Langevin, Ming Zhu, Matthew Bonaparte, Tifany Machabert, Stephen Savarino, et al. 2018. “Effect of Dengue Serostatus on Dengue Vaccine Safety and Efficacy.” <em>New England Journal of Medicine</em> 4: 327–40.</p>
</div>
<div id="ref-Vigne2017">
<p>Vigne, Claire, Martin Dupuy, Aline Richetin, Bruno Guy, Nicholas Jackson, Matthew Bonaparte, Branda Hu, et al. 2017. “Integrated Immunogenicity Analysis of a Tetravalent Dengue Vaccine up to 4 Y After Vaccination.” <em>Human Vaccines &amp; Immunotherapeutics</em> 13 (9). Taylor &amp; Francis: 2004–16.</p>
</div>
<div id="ref-Villaretal2015">
<p>Villar, Luis, Gustavo Horacio Dayan, José Luis Arredondo-García, Doris Maribel Rivera, Rivaldo Cunha, Carmen Deseda, Humberto Reynales, et al. 2015. “Efficacy of a Tetravalent Dengue Vaccine in Children in Latin America.” <em>New England Journal of Medicine</em> 372. Mass Medical Soc: 113–23.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
